version: 2
jobs:
  build_zsh551:
    docker:
      - image: circleci/python:2.7-node
    steps:
      - checkout
      - run:
          name: Install zsh
          command: |
            export LOCAL="$(mktemp --directory --tmpdir=${TMPDIR:-/tmp} local.XXXXXX)"
            export DEP_ZSH_VERSION="zsh-5.5.1"
            curl -L http://downloads.sourceforge.net/zsh/$DEP_ZSH_VERSION.tar.gz | tar zx
            cd $DEP_ZSH_VERSION
            ./configure --prefix=$LOCAL
            make
            make install
            cd -
            export PATH="$LOCAL/bin:$PATH"
      - run:
          name: Install requirements
          command: |
            pip install -r test-requirements.txt
            npm install --only=dev
      - run:
          name: Print versions
            zsh --version
            bash --version
            npm --version
            node --version

      - run:
          name: Test
          command: make test
workflows:
  version: 2
  build_all:
    jobs:
      - build_zsh551
